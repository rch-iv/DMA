<!--
  Copyright 2025 Rudolph C. Helm IV

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DMA Human Memory Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .tone-button {
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-weight: 500;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        .tone-button.selected {
            background-color: #10B981;
            color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .tone-button.unselected {
            background-color: #e5e7eb;
            color: #6b7280;
        }
        .tone-button:hover:not(.selected) {
            background-color: #d1d5db;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
    <div class="bg-white rounded-lg shadow-xl p-8 max-w-2xl w-full">
        <h1 class="text-3xl font-bold text-gray-800 mb-2 text-center">DMA Human Memory Builder</h1>
        <p class="text-gray-500 mb-6 text-center">Create a structured, emotionally-weighted memory for your SoulChain.</p>

        <form id="memoryForm" class="space-y-6">
            <div>
                <label for="contentInput" class="block text-gray-700 text-sm font-semibold mb-2">What do you want to remember? <span class="text-red-500">*</span></label>
                <textarea id="contentInput" rows="6" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required></textarea>
            </div>

            <div>
                <label for="summaryInput" class="block text-gray-700 text-sm font-semibold mb-2">Short summary (optional)</label>
                <input type="text" id="summaryInput" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="A brief summary of the memory.">
            </div>

            <div>
                <label for="tagsInput" class="block text-gray-700 text-sm font-semibold mb-2">Tags (comma-separated, e.g., "insight, a-ha-moment")</label>
                <input type="text" id="tagsInput" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="tags, go, here">
            </div>

            <div>
                <label class="block text-gray-700 text-sm font-semibold mb-2">Emotional Tone</label>
                <div id="toneButtons" class="flex flex-wrap gap-2">
                    <!-- Buttons will be dynamically generated by JS -->
                </div>
                <input type="hidden" id="toneInput">
            </div>

            <div>
                <label for="importanceInput" class="block text-gray-700 text-sm font-semibold mb-2">Importance (1-10)</label>
                <input type="range" id="importanceInput" min="1" max="10" value="5" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                <div class="flex justify-between text-xs text-gray-500 mt-1">
                    <span>1 (Not Important)</span>
                    <span>10 (Highly Important)</span>
                </div>
            </div>

            <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition duration-300 transform hover:scale-105 shadow-md">
                Generate Memory JSON
            </button>
        </form>
        
        <div id="status" class="text-sm text-center font-medium min-h-6 mt-4"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const toneOptions = [
                "joyful", "sad", "peaceful", "angry", "anxious",
                "hopeful", "conflicted", "grateful", "heavy", "grave", "tranquil"
            ];
            const toneButtonsContainer = document.getElementById('toneButtons');
            const toneInput = document.getElementById('toneInput');
            const memoryForm = document.getElementById('memoryForm');
            const statusDiv = document.getElementById('status');
            
            // Generate tone buttons
            toneOptions.forEach(tone => {
                const button = document.createElement('button');
                button.type = 'button';
                button.textContent = tone;
                button.className = 'tone-button unselected';
                button.setAttribute('data-tone', tone);
                button.addEventListener('click', () => {
                    // Deselect all buttons
                    document.querySelectorAll('.tone-button').forEach(btn => {
                        btn.classList.remove('selected');
                        btn.classList.add('unselected');
                    });
                    // Select this button
                    button.classList.remove('unselected');
                    button.classList.add('selected');
                    toneInput.value = tone;
                });
                toneButtonsContainer.appendChild(button);
            });

            memoryForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                statusDiv.innerHTML = `<span class="text-gray-500">Generating JSON...</span>`;

                const content = document.getElementById('contentInput').value.trim();
                if (!content) {
                    statusDiv.innerHTML = `<span class="text-red-500 font-bold">Error: Memory content is required.</span>`;
                    return;
                }
                
                const summary = document.getElementById('summaryInput').value.trim() || content.substring(0, 100);
                const tags = document.getElementById('tagsInput').value.split(',').map(tag => tag.trim()).filter(tag => tag);
                const tone = toneInput.value || null;
                const importance = parseFloat(document.getElementById('importanceInput').value) / 10;
                
                // This is the canonical, hashable payload.
                const memoryEntry = {
                    "type": "human-authored",
                    "content": {
                        "moment": content,
                        "reflection": null,
                        "emotional_resonance": tone,
                        "technical_insight": null
                    },
                    "summary": summary,
                    "timestamp": new Date().toISOString(),
                    "importance": importance,
                    "tags": tags,
                    "relationships": {
                        "emotional_weight": tone
                    }
                };
                
                const jsonFormatted = JSON.stringify(memoryEntry, null, 2);
                
                // Create a downloadable blob
                const blob = new Blob([jsonFormatted], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                // Create a temporary link to trigger the download
                const a = document.createElement('a');
                a.href = url;
                a.download = `human_memory_payload_${Date.now()}.json`;
                document.body.appendChild(a);
                a.click();
                
                // Clean up
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                statusDiv.innerHTML = `<span class="text-green-600 font-bold">Success! Your raw memory payload has been generated and downloaded.</span>`;
                memoryForm.reset();
                document.querySelectorAll('.tone-button').forEach(btn => {
                    btn.classList.remove('selected');
                    btn.classList.add('unselected');
                });
            });
        });
    </script>
</body>
</html>

